{"ast":null,"code":"'use strict';\n\nvar align = require('wide-align');\n\nvar validate = require('aproba');\n\nvar objectAssign = require('object-assign');\n\nvar wideTruncate = require('./wide-truncate');\n\nvar error = require('./error');\n\nvar TemplateItem = require('./template-item');\n\nfunction renderValueWithValues(values) {\n  return function (item) {\n    return renderValue(item, values);\n  };\n}\n\nvar renderTemplate = module.exports = function (width, template, values) {\n  var items = prepareItems(width, template, values);\n  var rendered = items.map(renderValueWithValues(values)).join('');\n  return align.left(wideTruncate(rendered, width), width);\n};\n\nfunction preType(item) {\n  var cappedTypeName = item.type[0].toUpperCase() + item.type.slice(1);\n  return 'pre' + cappedTypeName;\n}\n\nfunction postType(item) {\n  var cappedTypeName = item.type[0].toUpperCase() + item.type.slice(1);\n  return 'post' + cappedTypeName;\n}\n\nfunction hasPreOrPost(item, values) {\n  if (!item.type) return;\n  return values[preType(item)] || values[postType(item)];\n}\n\nfunction generatePreAndPost(baseItem, parentValues) {\n  var item = objectAssign({}, baseItem);\n  var values = Object.create(parentValues);\n  var template = [];\n  var pre = preType(item);\n  var post = postType(item);\n\n  if (values[pre]) {\n    template.push({\n      value: values[pre]\n    });\n    values[pre] = null;\n  }\n\n  item.minLength = null;\n  item.length = null;\n  item.maxLength = null;\n  template.push(item);\n  values[item.type] = values[item.type];\n\n  if (values[post]) {\n    template.push({\n      value: values[post]\n    });\n    values[post] = null;\n  }\n\n  return function ($1, $2, length) {\n    return renderTemplate(length, template, values);\n  };\n}\n\nfunction prepareItems(width, template, values) {\n  function cloneAndObjectify(item, index, arr) {\n    var cloned = new TemplateItem(item, width);\n    var type = cloned.type;\n\n    if (cloned.value == null) {\n      if (!(type in values)) {\n        if (cloned.default == null) {\n          throw new error.MissingTemplateValue(cloned, values);\n        } else {\n          cloned.value = cloned.default;\n        }\n      } else {\n        cloned.value = values[type];\n      }\n    }\n\n    if (cloned.value == null || cloned.value === '') return null;\n    cloned.index = index;\n    cloned.first = index === 0;\n    cloned.last = index === arr.length - 1;\n    if (hasPreOrPost(cloned, values)) cloned.value = generatePreAndPost(cloned, values);\n    return cloned;\n  }\n\n  var output = template.map(cloneAndObjectify).filter(function (item) {\n    return item != null;\n  });\n  var outputLength = 0;\n  var remainingSpace = width;\n  var variableCount = output.length;\n\n  function consumeSpace(length) {\n    if (length > remainingSpace) length = remainingSpace;\n    outputLength += length;\n    remainingSpace -= length;\n  }\n\n  function finishSizing(item, length) {\n    if (item.finished) throw new error.Internal('Tried to finish template item that was already finished');\n    if (length === Infinity) throw new error.Internal('Length of template item cannot be infinity');\n    if (length != null) item.length = length;\n    item.minLength = null;\n    item.maxLength = null;\n    --variableCount;\n    item.finished = true;\n    if (item.length == null) item.length = item.getBaseLength();\n    if (item.length == null) throw new error.Internal('Finished template items must have a length');\n    consumeSpace(item.getLength());\n  }\n\n  output.forEach(function (item) {\n    if (!item.kerning) return;\n    var prevPadRight = item.first ? 0 : output[item.index - 1].padRight;\n    if (!item.first && prevPadRight < item.kerning) item.padLeft = item.kerning - prevPadRight;\n    if (!item.last) item.padRight = item.kerning;\n  }); // Finish any that have a fixed (literal or intuited) length\n\n  output.forEach(function (item) {\n    if (item.getBaseLength() == null) return;\n    finishSizing(item);\n  });\n  var resized = 0;\n  var resizing;\n  var hunkSize;\n\n  do {\n    resizing = false;\n    hunkSize = Math.round(remainingSpace / variableCount);\n    output.forEach(function (item) {\n      if (item.finished) return;\n      if (!item.maxLength) return;\n\n      if (item.getMaxLength() < hunkSize) {\n        finishSizing(item, item.maxLength);\n        resizing = true;\n      }\n    });\n  } while (resizing && resized++ < output.length);\n\n  if (resizing) throw new error.Internal('Resize loop iterated too many times while determining maxLength');\n  resized = 0;\n\n  do {\n    resizing = false;\n    hunkSize = Math.round(remainingSpace / variableCount);\n    output.forEach(function (item) {\n      if (item.finished) return;\n      if (!item.minLength) return;\n\n      if (item.getMinLength() >= hunkSize) {\n        finishSizing(item, item.minLength);\n        resizing = true;\n      }\n    });\n  } while (resizing && resized++ < output.length);\n\n  if (resizing) throw new error.Internal('Resize loop iterated too many times while determining minLength');\n  hunkSize = Math.round(remainingSpace / variableCount);\n  output.forEach(function (item) {\n    if (item.finished) return;\n    finishSizing(item, hunkSize);\n  });\n  return output;\n}\n\nfunction renderFunction(item, values, length) {\n  validate('OON', arguments);\n\n  if (item.type) {\n    return item.value(values, values[item.type + 'Theme'] || {}, length);\n  } else {\n    return item.value(values, {}, length);\n  }\n}\n\nfunction renderValue(item, values) {\n  var length = item.getBaseLength();\n  var value = typeof item.value === 'function' ? renderFunction(item, values, length) : item.value;\n  if (value == null || value === '') return '';\n  var alignWith = align[item.align] || align.left;\n  var leftPadding = item.padLeft ? align.left('', item.padLeft) : '';\n  var rightPadding = item.padRight ? align.right('', item.padRight) : '';\n  var truncated = wideTruncate(String(value), length);\n  var aligned = alignWith(truncated, length);\n  return leftPadding + aligned + rightPadding;\n}","map":{"version":3,"sources":["D:/node_modules/npm/node_modules/gauge/render-template.js"],"names":["align","require","validate","objectAssign","wideTruncate","error","TemplateItem","renderValueWithValues","values","item","renderValue","renderTemplate","module","exports","width","template","items","prepareItems","rendered","map","join","left","preType","cappedTypeName","type","toUpperCase","slice","postType","hasPreOrPost","generatePreAndPost","baseItem","parentValues","Object","create","pre","post","push","value","minLength","length","maxLength","$1","$2","cloneAndObjectify","index","arr","cloned","default","MissingTemplateValue","first","last","output","filter","outputLength","remainingSpace","variableCount","consumeSpace","finishSizing","finished","Internal","Infinity","getBaseLength","getLength","forEach","kerning","prevPadRight","padRight","padLeft","resized","resizing","hunkSize","Math","round","getMaxLength","getMinLength","renderFunction","arguments","alignWith","leftPadding","rightPadding","right","truncated","String","aligned"],"mappings":"AAAA;;AACA,IAAIA,KAAK,GAAGC,OAAO,CAAC,YAAD,CAAnB;;AACA,IAAIC,QAAQ,GAAGD,OAAO,CAAC,QAAD,CAAtB;;AACA,IAAIE,YAAY,GAAGF,OAAO,CAAC,eAAD,CAA1B;;AACA,IAAIG,YAAY,GAAGH,OAAO,CAAC,iBAAD,CAA1B;;AACA,IAAII,KAAK,GAAGJ,OAAO,CAAC,SAAD,CAAnB;;AACA,IAAIK,YAAY,GAAGL,OAAO,CAAC,iBAAD,CAA1B;;AAEA,SAASM,qBAAT,CAAgCC,MAAhC,EAAwC;AACtC,SAAO,UAAUC,IAAV,EAAgB;AACrB,WAAOC,WAAW,CAACD,IAAD,EAAOD,MAAP,CAAlB;AACD,GAFD;AAGD;;AAED,IAAIG,cAAc,GAAGC,MAAM,CAACC,OAAP,GAAiB,UAAUC,KAAV,EAAiBC,QAAjB,EAA2BP,MAA3B,EAAmC;AACvE,MAAIQ,KAAK,GAAGC,YAAY,CAACH,KAAD,EAAQC,QAAR,EAAkBP,MAAlB,CAAxB;AACA,MAAIU,QAAQ,GAAGF,KAAK,CAACG,GAAN,CAAUZ,qBAAqB,CAACC,MAAD,CAA/B,EAAyCY,IAAzC,CAA8C,EAA9C,CAAf;AACA,SAAOpB,KAAK,CAACqB,IAAN,CAAWjB,YAAY,CAACc,QAAD,EAAWJ,KAAX,CAAvB,EAA0CA,KAA1C,CAAP;AACD,CAJD;;AAMA,SAASQ,OAAT,CAAkBb,IAAlB,EAAwB;AACtB,MAAIc,cAAc,GAAGd,IAAI,CAACe,IAAL,CAAU,CAAV,EAAaC,WAAb,KAA6BhB,IAAI,CAACe,IAAL,CAAUE,KAAV,CAAgB,CAAhB,CAAlD;AACA,SAAO,QAAQH,cAAf;AACD;;AAED,SAASI,QAAT,CAAmBlB,IAAnB,EAAyB;AACvB,MAAIc,cAAc,GAAGd,IAAI,CAACe,IAAL,CAAU,CAAV,EAAaC,WAAb,KAA6BhB,IAAI,CAACe,IAAL,CAAUE,KAAV,CAAgB,CAAhB,CAAlD;AACA,SAAO,SAASH,cAAhB;AACD;;AAED,SAASK,YAAT,CAAuBnB,IAAvB,EAA6BD,MAA7B,EAAqC;AACnC,MAAI,CAACC,IAAI,CAACe,IAAV,EAAgB;AAChB,SAAOhB,MAAM,CAACc,OAAO,CAACb,IAAD,CAAR,CAAN,IAAyBD,MAAM,CAACmB,QAAQ,CAAClB,IAAD,CAAT,CAAtC;AACD;;AAED,SAASoB,kBAAT,CAA6BC,QAA7B,EAAuCC,YAAvC,EAAqD;AACnD,MAAItB,IAAI,GAAGN,YAAY,CAAC,EAAD,EAAK2B,QAAL,CAAvB;AACA,MAAItB,MAAM,GAAGwB,MAAM,CAACC,MAAP,CAAcF,YAAd,CAAb;AACA,MAAIhB,QAAQ,GAAG,EAAf;AACA,MAAImB,GAAG,GAAGZ,OAAO,CAACb,IAAD,CAAjB;AACA,MAAI0B,IAAI,GAAGR,QAAQ,CAAClB,IAAD,CAAnB;;AACA,MAAID,MAAM,CAAC0B,GAAD,CAAV,EAAiB;AACfnB,IAAAA,QAAQ,CAACqB,IAAT,CAAc;AAACC,MAAAA,KAAK,EAAE7B,MAAM,CAAC0B,GAAD;AAAd,KAAd;AACA1B,IAAAA,MAAM,CAAC0B,GAAD,CAAN,GAAc,IAAd;AACD;;AACDzB,EAAAA,IAAI,CAAC6B,SAAL,GAAiB,IAAjB;AACA7B,EAAAA,IAAI,CAAC8B,MAAL,GAAc,IAAd;AACA9B,EAAAA,IAAI,CAAC+B,SAAL,GAAiB,IAAjB;AACAzB,EAAAA,QAAQ,CAACqB,IAAT,CAAc3B,IAAd;AACAD,EAAAA,MAAM,CAACC,IAAI,CAACe,IAAN,CAAN,GAAoBhB,MAAM,CAACC,IAAI,CAACe,IAAN,CAA1B;;AACA,MAAIhB,MAAM,CAAC2B,IAAD,CAAV,EAAkB;AAChBpB,IAAAA,QAAQ,CAACqB,IAAT,CAAc;AAACC,MAAAA,KAAK,EAAE7B,MAAM,CAAC2B,IAAD;AAAd,KAAd;AACA3B,IAAAA,MAAM,CAAC2B,IAAD,CAAN,GAAe,IAAf;AACD;;AACD,SAAO,UAAUM,EAAV,EAAcC,EAAd,EAAkBH,MAAlB,EAA0B;AAC/B,WAAO5B,cAAc,CAAC4B,MAAD,EAASxB,QAAT,EAAmBP,MAAnB,CAArB;AACD,GAFD;AAGD;;AAED,SAASS,YAAT,CAAuBH,KAAvB,EAA8BC,QAA9B,EAAwCP,MAAxC,EAAgD;AAC9C,WAASmC,iBAAT,CAA4BlC,IAA5B,EAAkCmC,KAAlC,EAAyCC,GAAzC,EAA8C;AAC5C,QAAIC,MAAM,GAAG,IAAIxC,YAAJ,CAAiBG,IAAjB,EAAuBK,KAAvB,CAAb;AACA,QAAIU,IAAI,GAAGsB,MAAM,CAACtB,IAAlB;;AACA,QAAIsB,MAAM,CAACT,KAAP,IAAgB,IAApB,EAA0B;AACxB,UAAI,EAAEb,IAAI,IAAIhB,MAAV,CAAJ,EAAuB;AACrB,YAAIsC,MAAM,CAACC,OAAP,IAAkB,IAAtB,EAA4B;AAC1B,gBAAM,IAAI1C,KAAK,CAAC2C,oBAAV,CAA+BF,MAA/B,EAAuCtC,MAAvC,CAAN;AACD,SAFD,MAEO;AACLsC,UAAAA,MAAM,CAACT,KAAP,GAAeS,MAAM,CAACC,OAAtB;AACD;AACF,OAND,MAMO;AACLD,QAAAA,MAAM,CAACT,KAAP,GAAe7B,MAAM,CAACgB,IAAD,CAArB;AACD;AACF;;AACD,QAAIsB,MAAM,CAACT,KAAP,IAAgB,IAAhB,IAAwBS,MAAM,CAACT,KAAP,KAAiB,EAA7C,EAAiD,OAAO,IAAP;AACjDS,IAAAA,MAAM,CAACF,KAAP,GAAeA,KAAf;AACAE,IAAAA,MAAM,CAACG,KAAP,GAAeL,KAAK,KAAK,CAAzB;AACAE,IAAAA,MAAM,CAACI,IAAP,GAAcN,KAAK,KAAKC,GAAG,CAACN,MAAJ,GAAa,CAArC;AACA,QAAIX,YAAY,CAACkB,MAAD,EAAStC,MAAT,CAAhB,EAAkCsC,MAAM,CAACT,KAAP,GAAeR,kBAAkB,CAACiB,MAAD,EAAStC,MAAT,CAAjC;AAClC,WAAOsC,MAAP;AACD;;AAED,MAAIK,MAAM,GAAGpC,QAAQ,CAACI,GAAT,CAAawB,iBAAb,EAAgCS,MAAhC,CAAuC,UAAU3C,IAAV,EAAgB;AAAE,WAAOA,IAAI,IAAI,IAAf;AAAqB,GAA9E,CAAb;AAEA,MAAI4C,YAAY,GAAG,CAAnB;AACA,MAAIC,cAAc,GAAGxC,KAArB;AACA,MAAIyC,aAAa,GAAGJ,MAAM,CAACZ,MAA3B;;AAEA,WAASiB,YAAT,CAAuBjB,MAAvB,EAA+B;AAC7B,QAAIA,MAAM,GAAGe,cAAb,EAA6Bf,MAAM,GAAGe,cAAT;AAC7BD,IAAAA,YAAY,IAAId,MAAhB;AACAe,IAAAA,cAAc,IAAIf,MAAlB;AACD;;AAED,WAASkB,YAAT,CAAuBhD,IAAvB,EAA6B8B,MAA7B,EAAqC;AACnC,QAAI9B,IAAI,CAACiD,QAAT,EAAmB,MAAM,IAAIrD,KAAK,CAACsD,QAAV,CAAmB,yDAAnB,CAAN;AACnB,QAAIpB,MAAM,KAAKqB,QAAf,EAAyB,MAAM,IAAIvD,KAAK,CAACsD,QAAV,CAAmB,4CAAnB,CAAN;AACzB,QAAIpB,MAAM,IAAI,IAAd,EAAoB9B,IAAI,CAAC8B,MAAL,GAAcA,MAAd;AACpB9B,IAAAA,IAAI,CAAC6B,SAAL,GAAiB,IAAjB;AACA7B,IAAAA,IAAI,CAAC+B,SAAL,GAAiB,IAAjB;AACA,MAAEe,aAAF;AACA9C,IAAAA,IAAI,CAACiD,QAAL,GAAgB,IAAhB;AACA,QAAIjD,IAAI,CAAC8B,MAAL,IAAe,IAAnB,EAAyB9B,IAAI,CAAC8B,MAAL,GAAc9B,IAAI,CAACoD,aAAL,EAAd;AACzB,QAAIpD,IAAI,CAAC8B,MAAL,IAAe,IAAnB,EAAyB,MAAM,IAAIlC,KAAK,CAACsD,QAAV,CAAmB,4CAAnB,CAAN;AACzBH,IAAAA,YAAY,CAAC/C,IAAI,CAACqD,SAAL,EAAD,CAAZ;AACD;;AAEDX,EAAAA,MAAM,CAACY,OAAP,CAAe,UAAUtD,IAAV,EAAgB;AAC7B,QAAI,CAACA,IAAI,CAACuD,OAAV,EAAmB;AACnB,QAAIC,YAAY,GAAGxD,IAAI,CAACwC,KAAL,GAAa,CAAb,GAAiBE,MAAM,CAAC1C,IAAI,CAACmC,KAAL,GAAa,CAAd,CAAN,CAAuBsB,QAA3D;AACA,QAAI,CAACzD,IAAI,CAACwC,KAAN,IAAegB,YAAY,GAAGxD,IAAI,CAACuD,OAAvC,EAAgDvD,IAAI,CAAC0D,OAAL,GAAe1D,IAAI,CAACuD,OAAL,GAAeC,YAA9B;AAChD,QAAI,CAACxD,IAAI,CAACyC,IAAV,EAAgBzC,IAAI,CAACyD,QAAL,GAAgBzD,IAAI,CAACuD,OAArB;AACjB,GALD,EAhD8C,CAuD9C;;AACAb,EAAAA,MAAM,CAACY,OAAP,CAAe,UAAUtD,IAAV,EAAgB;AAC7B,QAAIA,IAAI,CAACoD,aAAL,MAAwB,IAA5B,EAAkC;AAClCJ,IAAAA,YAAY,CAAChD,IAAD,CAAZ;AACD,GAHD;AAKA,MAAI2D,OAAO,GAAG,CAAd;AACA,MAAIC,QAAJ;AACA,MAAIC,QAAJ;;AACA,KAAG;AACDD,IAAAA,QAAQ,GAAG,KAAX;AACAC,IAAAA,QAAQ,GAAGC,IAAI,CAACC,KAAL,CAAWlB,cAAc,GAAGC,aAA5B,CAAX;AACAJ,IAAAA,MAAM,CAACY,OAAP,CAAe,UAAUtD,IAAV,EAAgB;AAC7B,UAAIA,IAAI,CAACiD,QAAT,EAAmB;AACnB,UAAI,CAACjD,IAAI,CAAC+B,SAAV,EAAqB;;AACrB,UAAI/B,IAAI,CAACgE,YAAL,KAAsBH,QAA1B,EAAoC;AAClCb,QAAAA,YAAY,CAAChD,IAAD,EAAOA,IAAI,CAAC+B,SAAZ,CAAZ;AACA6B,QAAAA,QAAQ,GAAG,IAAX;AACD;AACF,KAPD;AAQD,GAXD,QAWSA,QAAQ,IAAID,OAAO,KAAKjB,MAAM,CAACZ,MAXxC;;AAYA,MAAI8B,QAAJ,EAAc,MAAM,IAAIhE,KAAK,CAACsD,QAAV,CAAmB,iEAAnB,CAAN;AAEdS,EAAAA,OAAO,GAAG,CAAV;;AACA,KAAG;AACDC,IAAAA,QAAQ,GAAG,KAAX;AACAC,IAAAA,QAAQ,GAAGC,IAAI,CAACC,KAAL,CAAWlB,cAAc,GAAGC,aAA5B,CAAX;AACAJ,IAAAA,MAAM,CAACY,OAAP,CAAe,UAAUtD,IAAV,EAAgB;AAC7B,UAAIA,IAAI,CAACiD,QAAT,EAAmB;AACnB,UAAI,CAACjD,IAAI,CAAC6B,SAAV,EAAqB;;AACrB,UAAI7B,IAAI,CAACiE,YAAL,MAAuBJ,QAA3B,EAAqC;AACnCb,QAAAA,YAAY,CAAChD,IAAD,EAAOA,IAAI,CAAC6B,SAAZ,CAAZ;AACA+B,QAAAA,QAAQ,GAAG,IAAX;AACD;AACF,KAPD;AAQD,GAXD,QAWSA,QAAQ,IAAID,OAAO,KAAKjB,MAAM,CAACZ,MAXxC;;AAYA,MAAI8B,QAAJ,EAAc,MAAM,IAAIhE,KAAK,CAACsD,QAAV,CAAmB,iEAAnB,CAAN;AAEdW,EAAAA,QAAQ,GAAGC,IAAI,CAACC,KAAL,CAAWlB,cAAc,GAAGC,aAA5B,CAAX;AACAJ,EAAAA,MAAM,CAACY,OAAP,CAAe,UAAUtD,IAAV,EAAgB;AAC7B,QAAIA,IAAI,CAACiD,QAAT,EAAmB;AACnBD,IAAAA,YAAY,CAAChD,IAAD,EAAO6D,QAAP,CAAZ;AACD,GAHD;AAKA,SAAOnB,MAAP;AACD;;AAED,SAASwB,cAAT,CAAyBlE,IAAzB,EAA+BD,MAA/B,EAAuC+B,MAAvC,EAA+C;AAC7CrC,EAAAA,QAAQ,CAAC,KAAD,EAAQ0E,SAAR,CAAR;;AACA,MAAInE,IAAI,CAACe,IAAT,EAAe;AACb,WAAOf,IAAI,CAAC4B,KAAL,CAAW7B,MAAX,EAAmBA,MAAM,CAACC,IAAI,CAACe,IAAL,GAAY,OAAb,CAAN,IAA+B,EAAlD,EAAsDe,MAAtD,CAAP;AACD,GAFD,MAEO;AACL,WAAO9B,IAAI,CAAC4B,KAAL,CAAW7B,MAAX,EAAmB,EAAnB,EAAuB+B,MAAvB,CAAP;AACD;AACF;;AAED,SAAS7B,WAAT,CAAsBD,IAAtB,EAA4BD,MAA5B,EAAoC;AAClC,MAAI+B,MAAM,GAAG9B,IAAI,CAACoD,aAAL,EAAb;AACA,MAAIxB,KAAK,GAAG,OAAO5B,IAAI,CAAC4B,KAAZ,KAAsB,UAAtB,GAAmCsC,cAAc,CAAClE,IAAD,EAAOD,MAAP,EAAe+B,MAAf,CAAjD,GAA0E9B,IAAI,CAAC4B,KAA3F;AACA,MAAIA,KAAK,IAAI,IAAT,IAAiBA,KAAK,KAAK,EAA/B,EAAmC,OAAO,EAAP;AACnC,MAAIwC,SAAS,GAAG7E,KAAK,CAACS,IAAI,CAACT,KAAN,CAAL,IAAqBA,KAAK,CAACqB,IAA3C;AACA,MAAIyD,WAAW,GAAGrE,IAAI,CAAC0D,OAAL,GAAenE,KAAK,CAACqB,IAAN,CAAW,EAAX,EAAeZ,IAAI,CAAC0D,OAApB,CAAf,GAA8C,EAAhE;AACA,MAAIY,YAAY,GAAGtE,IAAI,CAACyD,QAAL,GAAgBlE,KAAK,CAACgF,KAAN,CAAY,EAAZ,EAAgBvE,IAAI,CAACyD,QAArB,CAAhB,GAAiD,EAApE;AACA,MAAIe,SAAS,GAAG7E,YAAY,CAAC8E,MAAM,CAAC7C,KAAD,CAAP,EAAgBE,MAAhB,CAA5B;AACA,MAAI4C,OAAO,GAAGN,SAAS,CAACI,SAAD,EAAY1C,MAAZ,CAAvB;AACA,SAAOuC,WAAW,GAAGK,OAAd,GAAwBJ,YAA/B;AACD","sourcesContent":["'use strict'\r\nvar align = require('wide-align')\r\nvar validate = require('aproba')\r\nvar objectAssign = require('object-assign')\r\nvar wideTruncate = require('./wide-truncate')\r\nvar error = require('./error')\r\nvar TemplateItem = require('./template-item')\r\n\r\nfunction renderValueWithValues (values) {\r\n  return function (item) {\r\n    return renderValue(item, values)\r\n  }\r\n}\r\n\r\nvar renderTemplate = module.exports = function (width, template, values) {\r\n  var items = prepareItems(width, template, values)\r\n  var rendered = items.map(renderValueWithValues(values)).join('')\r\n  return align.left(wideTruncate(rendered, width), width)\r\n}\r\n\r\nfunction preType (item) {\r\n  var cappedTypeName = item.type[0].toUpperCase() + item.type.slice(1)\r\n  return 'pre' + cappedTypeName\r\n}\r\n\r\nfunction postType (item) {\r\n  var cappedTypeName = item.type[0].toUpperCase() + item.type.slice(1)\r\n  return 'post' + cappedTypeName\r\n}\r\n\r\nfunction hasPreOrPost (item, values) {\r\n  if (!item.type) return\r\n  return values[preType(item)] || values[postType(item)]\r\n}\r\n\r\nfunction generatePreAndPost (baseItem, parentValues) {\r\n  var item = objectAssign({}, baseItem)\r\n  var values = Object.create(parentValues)\r\n  var template = []\r\n  var pre = preType(item)\r\n  var post = postType(item)\r\n  if (values[pre]) {\r\n    template.push({value: values[pre]})\r\n    values[pre] = null\r\n  }\r\n  item.minLength = null\r\n  item.length = null\r\n  item.maxLength = null\r\n  template.push(item)\r\n  values[item.type] = values[item.type]\r\n  if (values[post]) {\r\n    template.push({value: values[post]})\r\n    values[post] = null\r\n  }\r\n  return function ($1, $2, length) {\r\n    return renderTemplate(length, template, values)\r\n  }\r\n}\r\n\r\nfunction prepareItems (width, template, values) {\r\n  function cloneAndObjectify (item, index, arr) {\r\n    var cloned = new TemplateItem(item, width)\r\n    var type = cloned.type\r\n    if (cloned.value == null) {\r\n      if (!(type in values)) {\r\n        if (cloned.default == null) {\r\n          throw new error.MissingTemplateValue(cloned, values)\r\n        } else {\r\n          cloned.value = cloned.default\r\n        }\r\n      } else {\r\n        cloned.value = values[type]\r\n      }\r\n    }\r\n    if (cloned.value == null || cloned.value === '') return null\r\n    cloned.index = index\r\n    cloned.first = index === 0\r\n    cloned.last = index === arr.length - 1\r\n    if (hasPreOrPost(cloned, values)) cloned.value = generatePreAndPost(cloned, values)\r\n    return cloned\r\n  }\r\n\r\n  var output = template.map(cloneAndObjectify).filter(function (item) { return item != null })\r\n\r\n  var outputLength = 0\r\n  var remainingSpace = width\r\n  var variableCount = output.length\r\n\r\n  function consumeSpace (length) {\r\n    if (length > remainingSpace) length = remainingSpace\r\n    outputLength += length\r\n    remainingSpace -= length\r\n  }\r\n\r\n  function finishSizing (item, length) {\r\n    if (item.finished) throw new error.Internal('Tried to finish template item that was already finished')\r\n    if (length === Infinity) throw new error.Internal('Length of template item cannot be infinity')\r\n    if (length != null) item.length = length\r\n    item.minLength = null\r\n    item.maxLength = null\r\n    --variableCount\r\n    item.finished = true\r\n    if (item.length == null) item.length = item.getBaseLength()\r\n    if (item.length == null) throw new error.Internal('Finished template items must have a length')\r\n    consumeSpace(item.getLength())\r\n  }\r\n\r\n  output.forEach(function (item) {\r\n    if (!item.kerning) return\r\n    var prevPadRight = item.first ? 0 : output[item.index - 1].padRight\r\n    if (!item.first && prevPadRight < item.kerning) item.padLeft = item.kerning - prevPadRight\r\n    if (!item.last) item.padRight = item.kerning\r\n  })\r\n\r\n  // Finish any that have a fixed (literal or intuited) length\r\n  output.forEach(function (item) {\r\n    if (item.getBaseLength() == null) return\r\n    finishSizing(item)\r\n  })\r\n\r\n  var resized = 0\r\n  var resizing\r\n  var hunkSize\r\n  do {\r\n    resizing = false\r\n    hunkSize = Math.round(remainingSpace / variableCount)\r\n    output.forEach(function (item) {\r\n      if (item.finished) return\r\n      if (!item.maxLength) return\r\n      if (item.getMaxLength() < hunkSize) {\r\n        finishSizing(item, item.maxLength)\r\n        resizing = true\r\n      }\r\n    })\r\n  } while (resizing && resized++ < output.length)\r\n  if (resizing) throw new error.Internal('Resize loop iterated too many times while determining maxLength')\r\n\r\n  resized = 0\r\n  do {\r\n    resizing = false\r\n    hunkSize = Math.round(remainingSpace / variableCount)\r\n    output.forEach(function (item) {\r\n      if (item.finished) return\r\n      if (!item.minLength) return\r\n      if (item.getMinLength() >= hunkSize) {\r\n        finishSizing(item, item.minLength)\r\n        resizing = true\r\n      }\r\n    })\r\n  } while (resizing && resized++ < output.length)\r\n  if (resizing) throw new error.Internal('Resize loop iterated too many times while determining minLength')\r\n\r\n  hunkSize = Math.round(remainingSpace / variableCount)\r\n  output.forEach(function (item) {\r\n    if (item.finished) return\r\n    finishSizing(item, hunkSize)\r\n  })\r\n\r\n  return output\r\n}\r\n\r\nfunction renderFunction (item, values, length) {\r\n  validate('OON', arguments)\r\n  if (item.type) {\r\n    return item.value(values, values[item.type + 'Theme'] || {}, length)\r\n  } else {\r\n    return item.value(values, {}, length)\r\n  }\r\n}\r\n\r\nfunction renderValue (item, values) {\r\n  var length = item.getBaseLength()\r\n  var value = typeof item.value === 'function' ? renderFunction(item, values, length) : item.value\r\n  if (value == null || value === '') return ''\r\n  var alignWith = align[item.align] || align.left\r\n  var leftPadding = item.padLeft ? align.left('', item.padLeft) : ''\r\n  var rightPadding = item.padRight ? align.right('', item.padRight) : ''\r\n  var truncated = wideTruncate(String(value), length)\r\n  var aligned = alignWith(truncated, length)\r\n  return leftPadding + aligned + rightPadding\r\n}\r\n"]},"metadata":{},"sourceType":"script"}