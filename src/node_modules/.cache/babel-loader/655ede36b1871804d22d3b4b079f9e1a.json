{"ast":null,"code":"var Transform = require('readable-stream').Transform;\n\nvar inherits = require('inherits');\n\nvar cyclist = require('cyclist');\n\nvar util = require('util');\n\nvar ParallelTransform = function (maxParallel, opts, ontransform) {\n  if (!(this instanceof ParallelTransform)) return new ParallelTransform(maxParallel, opts, ontransform);\n\n  if (typeof maxParallel === 'function') {\n    ontransform = maxParallel;\n    opts = null;\n    maxParallel = 1;\n  }\n\n  if (typeof opts === 'function') {\n    ontransform = opts;\n    opts = null;\n  }\n\n  if (!opts) opts = {};\n  if (!opts.highWaterMark) opts.highWaterMark = Math.max(maxParallel, 16);\n  if (opts.objectMode !== false) opts.objectMode = true;\n  Transform.call(this, opts);\n  this._maxParallel = maxParallel;\n  this._ontransform = ontransform;\n  this._destroyed = false;\n  this._flushed = false;\n  this._ordered = opts.ordered !== false;\n  this._buffer = this._ordered ? cyclist(maxParallel) : [];\n  this._top = 0;\n  this._bottom = 0;\n  this._ondrain = null;\n};\n\ninherits(ParallelTransform, Transform);\n\nParallelTransform.prototype.destroy = function () {\n  if (this._destroyed) return;\n  this._destroyed = true;\n  this.emit('close');\n};\n\nParallelTransform.prototype._transform = function (chunk, enc, callback) {\n  var self = this;\n  var pos = this._top++;\n\n  this._ontransform(chunk, function (err, data) {\n    if (self._destroyed) return;\n\n    if (err) {\n      self.emit('error', err);\n      self.push(null);\n      self.destroy();\n      return;\n    }\n\n    if (self._ordered) {\n      self._buffer.put(pos, data === undefined || data === null ? null : data);\n    } else {\n      self._buffer.push(data);\n    }\n\n    self._drain();\n  });\n\n  if (this._top - this._bottom < this._maxParallel) return callback();\n  this._ondrain = callback;\n};\n\nParallelTransform.prototype._flush = function (callback) {\n  this._flushed = true;\n  this._ondrain = callback;\n\n  this._drain();\n};\n\nParallelTransform.prototype._drain = function () {\n  if (this._ordered) {\n    while (this._buffer.get(this._bottom) !== undefined) {\n      var data = this._buffer.del(this._bottom++);\n\n      if (data === null) continue;\n      this.push(data);\n    }\n  } else {\n    while (this._buffer.length > 0) {\n      var data = this._buffer.pop();\n\n      this._bottom++;\n      if (data === null) continue;\n      this.push(data);\n    }\n  }\n\n  if (!this._drained() || !this._ondrain) return;\n  var ondrain = this._ondrain;\n  this._ondrain = null;\n  ondrain();\n};\n\nParallelTransform.prototype._drained = function () {\n  var diff = this._top - this._bottom;\n  return this._flushed ? !diff : diff < this._maxParallel;\n};\n\nmodule.exports = ParallelTransform;","map":{"version":3,"sources":["D:/node_modules/npm/node_modules/parallel-transform/index.js"],"names":["Transform","require","inherits","cyclist","util","ParallelTransform","maxParallel","opts","ontransform","highWaterMark","Math","max","objectMode","call","_maxParallel","_ontransform","_destroyed","_flushed","_ordered","ordered","_buffer","_top","_bottom","_ondrain","prototype","destroy","emit","_transform","chunk","enc","callback","self","pos","err","data","push","put","undefined","_drain","_flush","get","del","length","pop","_drained","ondrain","diff","module","exports"],"mappings":"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","sourcesContent":["var Transform = require('readable-stream').Transform;\r\nvar inherits = require('inherits');\r\nvar cyclist = require('cyclist');\r\nvar util = require('util');\r\n\r\nvar ParallelTransform = function(maxParallel, opts, ontransform) {\r\n\tif (!(this instanceof ParallelTransform)) return new ParallelTransform(maxParallel, opts, ontransform);\r\n\r\n\tif (typeof maxParallel === 'function') {\r\n\t\tontransform = maxParallel;\r\n\t\topts = null;\r\n\t\tmaxParallel = 1;\r\n\t}\r\n\tif (typeof opts === 'function') {\r\n\t\tontransform = opts;\r\n\t\topts = null;\r\n\t}\r\n\r\n\tif (!opts) opts = {};\r\n\tif (!opts.highWaterMark) opts.highWaterMark = Math.max(maxParallel, 16);\r\n\tif (opts.objectMode !== false) opts.objectMode = true;\r\n\r\n\tTransform.call(this, opts);\r\n\r\n\tthis._maxParallel = maxParallel;\r\n\tthis._ontransform = ontransform;\r\n\tthis._destroyed = false;\r\n\tthis._flushed = false;\r\n\tthis._ordered = opts.ordered !== false;\r\n\tthis._buffer = this._ordered ? cyclist(maxParallel) : [];\r\n\tthis._top = 0;\r\n\tthis._bottom = 0;\r\n\tthis._ondrain = null;\r\n};\r\n\r\ninherits(ParallelTransform, Transform);\r\n\r\nParallelTransform.prototype.destroy = function() {\r\n\tif (this._destroyed) return;\r\n\tthis._destroyed = true;\r\n\tthis.emit('close');\r\n};\r\n\r\nParallelTransform.prototype._transform = function(chunk, enc, callback) {\r\n\tvar self = this;\r\n\tvar pos = this._top++;\r\n\r\n\tthis._ontransform(chunk, function(err, data) {\r\n\t\tif (self._destroyed) return;\r\n\t\tif (err) {\r\n\t\t\tself.emit('error', err);\r\n\t\t\tself.push(null);\r\n\t\t\tself.destroy();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (self._ordered) {\r\n\t\t\tself._buffer.put(pos, (data === undefined || data === null) ? null : data);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself._buffer.push(data);\r\n\t\t}\r\n\t\tself._drain();\r\n\t});\r\n\r\n\tif (this._top - this._bottom < this._maxParallel) return callback();\r\n\tthis._ondrain = callback;\r\n};\r\n\r\nParallelTransform.prototype._flush = function(callback) {\r\n\tthis._flushed = true;\r\n\tthis._ondrain = callback;\r\n\tthis._drain();\r\n};\r\n\r\nParallelTransform.prototype._drain = function() {\r\n\tif (this._ordered) {\r\n\t\twhile (this._buffer.get(this._bottom) !== undefined) {\r\n\t\t\tvar data = this._buffer.del(this._bottom++);\r\n\t\t\tif (data === null) continue;\r\n\t\t\tthis.push(data);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\twhile (this._buffer.length > 0) {\r\n\t\t\tvar data =  this._buffer.pop();\r\n\t\t\tthis._bottom++;\r\n\t\t\tif (data === null) continue;\r\n\t\t\tthis.push(data);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tif (!this._drained() || !this._ondrain) return;\r\n\r\n\tvar ondrain = this._ondrain;\r\n\tthis._ondrain = null;\r\n\tondrain();\r\n};\r\n\r\nParallelTransform.prototype._drained = function() {\r\n\tvar diff = this._top - this._bottom;\r\n\treturn this._flushed ? !diff : diff < this._maxParallel;\r\n};\r\n\r\nmodule.exports = ParallelTransform;\r\n"]},"metadata":{},"sourceType":"script"}