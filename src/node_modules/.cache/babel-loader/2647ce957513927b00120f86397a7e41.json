{"ast":null,"code":"var RetryOperation = require('./retry_operation');\n\nexports.operation = function (options) {\n  var timeouts = exports.timeouts(options);\n  return new RetryOperation(timeouts, {\n    forever: options && options.forever,\n    unref: options && options.unref\n  });\n};\n\nexports.timeouts = function (options) {\n  if (options instanceof Array) {\n    return [].concat(options);\n  }\n\n  var opts = {\n    retries: 10,\n    factor: 2,\n    minTimeout: 1 * 1000,\n    maxTimeout: Infinity,\n    randomize: false\n  };\n\n  for (var key in options) {\n    opts[key] = options[key];\n  }\n\n  if (opts.minTimeout > opts.maxTimeout) {\n    throw new Error('minTimeout is greater than maxTimeout');\n  }\n\n  var timeouts = [];\n\n  for (var i = 0; i < opts.retries; i++) {\n    timeouts.push(this.createTimeout(i, opts));\n  }\n\n  if (options && options.forever && !timeouts.length) {\n    timeouts.push(this.createTimeout(i, opts));\n  } // sort the array numerically ascending\n\n\n  timeouts.sort(function (a, b) {\n    return a - b;\n  });\n  return timeouts;\n};\n\nexports.createTimeout = function (attempt, opts) {\n  var random = opts.randomize ? Math.random() + 1 : 1;\n  var timeout = Math.round(random * opts.minTimeout * Math.pow(opts.factor, attempt));\n  timeout = Math.min(timeout, opts.maxTimeout);\n  return timeout;\n};\n\nexports.wrap = function (obj, options, methods) {\n  if (options instanceof Array) {\n    methods = options;\n    options = null;\n  }\n\n  if (!methods) {\n    methods = [];\n\n    for (var key in obj) {\n      if (typeof obj[key] === 'function') {\n        methods.push(key);\n      }\n    }\n  }\n\n  for (var i = 0; i < methods.length; i++) {\n    var method = methods[i];\n    var original = obj[method];\n\n    obj[method] = function retryWrapper() {\n      var op = exports.operation(options);\n      var args = Array.prototype.slice.call(arguments);\n      var callback = args.pop();\n      args.push(function (err) {\n        if (op.retry(err)) {\n          return;\n        }\n\n        if (err) {\n          arguments[0] = op.mainError();\n        }\n\n        callback.apply(this, arguments);\n      });\n      op.attempt(function () {\n        original.apply(obj, args);\n      });\n    };\n\n    obj[method].options = options;\n  }\n};","map":{"version":3,"sources":["D:/node_modules/npm/node_modules/promise-retry/node_modules/retry/lib/retry.js"],"names":["RetryOperation","require","exports","operation","options","timeouts","forever","unref","Array","concat","opts","retries","factor","minTimeout","maxTimeout","Infinity","randomize","key","Error","i","push","createTimeout","length","sort","a","b","attempt","random","Math","timeout","round","pow","min","wrap","obj","methods","method","original","retryWrapper","op","args","prototype","slice","call","arguments","callback","pop","err","retry","mainError","apply"],"mappings":"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","sourcesContent":["var RetryOperation = require('./retry_operation');\r\n\r\nexports.operation = function(options) {\r\n  var timeouts = exports.timeouts(options);\r\n  return new RetryOperation(timeouts, {\r\n      forever: options && options.forever,\r\n      unref: options && options.unref\r\n  });\r\n};\r\n\r\nexports.timeouts = function(options) {\r\n  if (options instanceof Array) {\r\n    return [].concat(options);\r\n  }\r\n\r\n  var opts = {\r\n    retries: 10,\r\n    factor: 2,\r\n    minTimeout: 1 * 1000,\r\n    maxTimeout: Infinity,\r\n    randomize: false\r\n  };\r\n  for (var key in options) {\r\n    opts[key] = options[key];\r\n  }\r\n\r\n  if (opts.minTimeout > opts.maxTimeout) {\r\n    throw new Error('minTimeout is greater than maxTimeout');\r\n  }\r\n\r\n  var timeouts = [];\r\n  for (var i = 0; i < opts.retries; i++) {\r\n    timeouts.push(this.createTimeout(i, opts));\r\n  }\r\n\r\n  if (options && options.forever && !timeouts.length) {\r\n    timeouts.push(this.createTimeout(i, opts));\r\n  }\r\n\r\n  // sort the array numerically ascending\r\n  timeouts.sort(function(a,b) {\r\n    return a - b;\r\n  });\r\n\r\n  return timeouts;\r\n};\r\n\r\nexports.createTimeout = function(attempt, opts) {\r\n  var random = (opts.randomize)\r\n    ? (Math.random() + 1)\r\n    : 1;\r\n\r\n  var timeout = Math.round(random * opts.minTimeout * Math.pow(opts.factor, attempt));\r\n  timeout = Math.min(timeout, opts.maxTimeout);\r\n\r\n  return timeout;\r\n};\r\n\r\nexports.wrap = function(obj, options, methods) {\r\n  if (options instanceof Array) {\r\n    methods = options;\r\n    options = null;\r\n  }\r\n\r\n  if (!methods) {\r\n    methods = [];\r\n    for (var key in obj) {\r\n      if (typeof obj[key] === 'function') {\r\n        methods.push(key);\r\n      }\r\n    }\r\n  }\r\n\r\n  for (var i = 0; i < methods.length; i++) {\r\n    var method   = methods[i];\r\n    var original = obj[method];\r\n\r\n    obj[method] = function retryWrapper() {\r\n      var op       = exports.operation(options);\r\n      var args     = Array.prototype.slice.call(arguments);\r\n      var callback = args.pop();\r\n\r\n      args.push(function(err) {\r\n        if (op.retry(err)) {\r\n          return;\r\n        }\r\n        if (err) {\r\n          arguments[0] = op.mainError();\r\n        }\r\n        callback.apply(this, arguments);\r\n      });\r\n\r\n      op.attempt(function() {\r\n        original.apply(obj, args);\r\n      });\r\n    };\r\n    obj[method].options = options;\r\n  }\r\n};\r\n"]},"metadata":{},"sourceType":"script"}